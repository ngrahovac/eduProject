@inject Microsoft.JSInterop.IJSRuntime js
@inject ProjectApplicationInputModel model

<style>
</style>

<div class="section">

    @if (ProjectDisplayModels.AcceptsApplications == true)
    {

<div class="collaborator-profiles-table">
    <table class="table table-hover table-bordered">
        <caption>Preporučeni profili</caption>
        <thead class="thead-dark">
            <tr>
                <th>Aplikacije otvorene</th>
                <th>Opis pozicije</th>
            </tr>
        </thead>

        @foreach (var profile in profileList)
        {
@if (profile.Recommended == true && profile.ApplicationsOpen == true)
{
<tr bgcolor="palegreen">
    <td style="background=purple">@profile.ApplicationsOpen</td>
    <td style="background=purple">@profile.Description</td>
</tr>
               }}



    </table>
</div>

                <div class="collaborator-profiles-table">
                    <table class="table table-hover table-bordered">
                        <caption>Ostali profili</caption>
                        <thead class="thead-dark">
                            <tr>
                                <th>Aplikacije otvorene</th>
                                <th>Opis pozicije</th>
                            </tr>
                        </thead>
                        @foreach (var profile in profileList)
                        {
        @if (profile.Recommended == false && profile.ApplicationsOpen == true)
        {
<tr bgcolor="LemonChiffon" disable>
    <td>@profile.ApplicationsOpen</td>
    <td>@profile.Description</td>
</tr>
               }}

                    </table>
                </div>

                                <div class="collaborator-profiles-table">
                                    <table class="table table-hover table-bordered">
                                        <caption>Popunjeni profili</caption>
                                        <thead class="thead-dark">
                                            <tr>
                                                <th>Aplikacije otvorene</th>
                                                <th>Opis pozicije</th>
                                            </tr>
                                        </thead>

                                        @foreach (var profile in profileList)
                                        {
                        @if (profile.AlreadyApplied == true || profile.ApplicationsOpen == false)
                        {
    <tr bgcolor="LightPink">
        <td>@profile.ApplicationsOpen</td>
        <td>@profile.Description</td>
    </tr>
           }}


                                    </table>
                                </div> } @*@if(FacultyMemberProfileDisplayModels.Count() > 0)
                                {
                                    <div class="collaborator-profiles-table">
                                    <table class="table table-hover table-bordered" id="faculty-member-profiles">
                                        <caption>Profili nastavnog osoblja</caption>
                                        <thead class="thead-dark">
                                            <tr>
                                                <th>Fakultet</th>
                                                <th>Naučna oblast</th>
                                                <th>Opis aktivnosti</th>
                                            </tr>
                                        </thead>

                                            @for (int i = 0; i < FacultyMemberProfileDisplayModels.Count(); i++)
                                            {
                                                int index = i;
                                                FacultyMemberProfileDisplayModel profile = FacultyMemberProfileDisplayModels.ElementAt(index);

                                                if (IsProjectRecommended && profile.Recommended)
                                                {
                                                    <tr class="recommended-profile"
                                                        @onclick="@(()=>CollaboratorProfileSelected("faculty-member-profiles", "student-profiles", profile.CollaboratorProfileId, index))">
                                                        <td>@profile.FacultyName</td>
                                                        <td>@profile.StudyFieldName</td>
                                                        <td>@profile.Description</td>
                                                    </tr>
                                                }
                                                else
                                                {
                                                    <tr @onclick="@(()=>CollaboratorProfileSelected("faculty-member-profiles", "student-profiles", profile.CollaboratorProfileId, index))">
                                                        <td>@profile.FacultyName</td>
                                                        <td>@profile.StudyFieldName</td>
                                                        <td>@profile.Description</td>
                                                    </tr>
                                                }
                                            }

                                    </table>
                                </div>
                                }


                                @if(StudentProfileDisplayModels.Count() > 0)
                                {
                                    <div class="collaborator-profiles-table">
                                    <table class="table table-hover table-bordered" id="student-profiles">
                                        <caption>Profili studenata</caption>
                                        <thead class="thead-dark">
                                            <tr>
                                                <th>Fakultet</th>
                                                <th>Ciklus</th>
                                                <th>Studijski program</th>
                                                <th>Studijski smjer</th>
                                                <th>Godina</th>
                                                <th>Opis aktivnosti</th>
                                            </tr>
                                        </thead>

                                        @for (int i = 0; i < StudentProfileDisplayModels.Count(); i++)
                                        {
                                            int index = i;
                                            StudentProfileDisplayModel profile = StudentProfileDisplayModels.ElementAt(index);

                                            @if (IsProjectRecommended && profile.Recommended)
                                            {
                                                <tr class="recommended-profile" @onclick="@(() => CollaboratorProfileSelected("student-profiles", "faculty-member-profiles", profile.CollaboratorProfileId, index))">
                                                    <td>@profile.FacultyName</td>
                                                    <td>@profile.StudyCycle</td>
                                                    <td>@profile.StudyProgramName</td>
                                                    <td>@profile.StudyProgramSpecializationName</td>
                                                    <td>@profile.StudyYear</td>
                                                    <td>@profile.Description</td>


                                                </tr>
                                            }
                                            else
                                            {
                                                <tr @onclick="@(() => CollaboratorProfileSelected("student-profiles", "faculty-member-profiles", profile.CollaboratorProfileId, index))">
                                                    <td>@profile.FacultyName</td>
                                                    <td>@profile.StudyCycle</td>
                                                    <td>@profile.StudyProgramName</td>
                                                    <td>@profile.StudyProgramSpecializationName</td>
                                                    <td>@profile.StudyYear</td>
                                                    <td>@profile.Description</td>
                                                </tr>
                                            }

                                        }
                                    </table>
                                </div>
                                }*@


</div>


@code { [Parameter]
    public ProjectDisplayModel ProjectDisplayModels { get; set; }

    public ICollection<CollaboratorProfileDisplayModel> profileList = new List<CollaboratorProfileDisplayModel>();


    protected override async Task OnInitializedAsync()
    {
        profileList = ProjectDisplayModels.GetCollaboratorProfileDisplayModels();
        foreach (var a in profileList)
        {
            Console.WriteLine("Profile list: " + a.Description);
        }
        Console.WriteLine("TestConsole");
    }




    [Parameter]
    public bool IsProjectRecommended { get; set; }

    [Parameter]
    public ICollection<StudentProfileDisplayModel> StudentProfileDisplayModels { get; set; }

    [Parameter]
    public ICollection<FacultyMemberProfileDisplayModel> FacultyMemberProfileDisplayModels { get; set; }


    public async Task CollaboratorProfileSelected(string tableToHighlight, string tableToClear, int collaboratorProfileId, int index)
    {
        string[] tablesToClear = { tableToClear };
        js.InvokeVoidAsync("setTableHighlight", tableToHighlight, index, tablesToClear);
        model.CollaboratorProfileId = collaboratorProfileId;
    }

    public async Task HighlightRecommendedProfile(string tableToHighlight, int index)
    {
        await js.InvokeVoidAsync("highlightRecommendedProfile", tableToHighlight, index);
    }

    protected override void OnAfterRender(bool firstRender)
    {
        base.OnAfterRender(firstRender);
        if (firstRender)
        {
            model.CollaboratorProfileId = 0;
        }
    } }
